<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dollar Empire Alpha 0.3</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #1e1e1e;
            --text-color: #e0e0e0;
            --money-color: #4caf50;
            --button-color: #333;
            --button-hover: #444;
            --tab-active: #2d2d2d;
            --boost-color: #ff9800;
            --manager-color: #2196f3;
            --achievement-color: #9c27b0;
        }
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            user-select: none;
            touch-action: manipulation;
        }
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--panel-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        #balance {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--money-color);
        }
        #income-per-sec {
            font-size: 0.8em;
            color: #888;
        }
        #collect-all {
            background: linear-gradient(45deg, #ff6b00, #ffa000);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        #tabs {
            display: flex;
            background-color: var(--panel-color);
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        .tab-button {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            min-width: 60px;
        }
        .tab-button.active {
            background-color: var(--tab-active);
            font-weight: bold;
        }
        .tab-content {
            display: none;
            background-color: var(--panel-color);
            padding: 15px;
            border-radius: 12px;
            min-height: 50vh;
            max-height: 60vh;
            overflow-y: auto;
        }
        .tab-content.active {
            display: block;
        }
        #coin-container {
            text-align: center;
            padding: 20px 0;
        }
        #coin {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #daa520);
            border-radius: 50%;
            margin: 0 auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            transition: transform 0.1s;
        }
        #coin:active {
            transform: scale(0.92);
        }
        #version {
            text-align: center;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8em;
            margin-top: 5px;
        }
        .business-item, .upgrade-item, .manager-item, .boost-item, .achievement-item {
            background-color: var(--button-color);
            padding: 15px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            color: var(--text-color);
            text-align: left;
            width: 100%;
        }
        .business-item:disabled, .upgrade-item:disabled, .manager-item:disabled, .boost-item:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .business-header, .upgrade-header, .manager-header, .boost-header, .achievement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .business-name, .upgrade-name, .manager-name, .boost-name, .achievement-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        .business-income {
            color: #4caf50;
            font-weight: bold;
        }
        .business-cost, .upgrade-cost, .manager-cost, .boost-cost {
            color: #f44336;
            font-weight: bold;
        }
        .business-level, .upgrade-level {
            color: #bb86fc;
            font-size: 0.9em;
        }
        .business-accumulated {
            color: #ff9800;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .manager-owned {
            color: var(--manager-color);
            font-weight: bold;
        }
        .boost-timer {
            color: var(--boost-color);
            font-weight: bold;
        }
        .achievement-description {
            color: #ccc;
            font-size: 0.9em;
        }
        .achievement-progress {
            background: #333;
            height: 8px;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        .achievement-progress-bar {
            background: var(--achievement-color);
            height: 100%;
            transition: width 0.3s;
        }
        #leaderboard-list {
            max-height: 50vh;
            overflow-y: auto;
        }
        .leaderboard-item {
            padding: 10px;
            margin: 5px 0;
            background: #2a2a2a;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
        }
        .leaderboard-rank {
            font-weight: bold;
            color: #ffd700;
            margin-right: 10px;
        }
        .leaderboard-name {
            flex-grow: 1;
        }
        .leaderboard-score {
            color: var(--money-color);
            font-weight: bold;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-item {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--money-color);
        }
        .stat-label {
            font-size: 0.8em;
            color: #888;
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            animation: fadeInOut 2s ease-in-out;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translate(-50%, -20px); }
            10%, 90% { opacity: 1; transform: translate(-50%, 0); }
        }
        #business-list, #upgrades-list, #managers-list, #boosts-list, #achievements-list {
            max-height: 55vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="header">
        <div>
            <div id="balance">$0.00</div>
            <div id="income-per-sec">+$0.0/—Å–µ–∫</div>
        </div>
        <button id="collect-all" onclick="collectAllIncome()">–°–û–ë–†–ê–¢–¨ –í–°–Å</button>
    </div>

    <div id="tabs">
        <button class="tab-button active" onclick="switchTab('main')">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="tab-button" onclick="switchTab('business')">–ë–∏–∑–Ω–µ—Å</button>
        <button class="tab-button" onclick="switchTab('upgrades')">–£–ª—É—á—à–µ–Ω–∏—è</button>
        <button class="tab-button" onclick="switchTab('managers')">–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</button>
        <button class="tab-button" onclick="switchTab('boosts')">–ë—É—Å—Ç—ã</button>
        <button class="tab-button" onclick="switchTab('achievements')">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        <button class="tab-button" onclick="switchTab('leaderboard')">–¢–æ–ø</button>
        <button class="tab-button" onclick="switchTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    </div>

    <div id="main-tab" class="tab-content active">
        <div id="coin-container">
            <div id="coin" onclick="clickCoin()">–ö–õ–ò–ö–ê–ô!</div>
            <p>–ó–∞ –∫–ª–∏–∫: <span id="coins-per-click">1</span>$</p>
            <div id="version">Alpha 0.3</div>
        </div>
        <button onclick="claimChannelBonus()" style="margin-top: 20px; width: 100%;">
            üéÅ –ü–æ–ª—É—á–∏—Ç—å +100$ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
        </button>
    </div>

    <div id="business-tab" class="tab-content">
        <div id="business-list"></div>
    </div>

    <div id="upgrades-tab" class="tab-content">
        <div id="upgrades-list"></div>
    </div>

    <div id="managers-tab" class="tab-content">
        <div id="managers-list"></div>
    </div>

    <div id="boosts-tab" class="tab-content">
        <div id="boosts-list"></div>
    </div>

    <div id="achievements-tab" class="tab-content">
        <div id="achievements-list"></div>
    </div>

    <div id="leaderboard-tab" class="tab-content">
        <div id="leaderboard-list"></div>
        <button onclick="updateGlobalLeaderboard()" style="margin-top: 10px; width: 100%;">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
        </button>
    </div>

    <div id="stats-tab" class="tab-content">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="stat-total-earned">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-total-clicks">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-total-businesses">0</div>
                <div class="stat-label">–ö—É–ø–ª–µ–Ω–æ –±–∏–∑–Ω–µ—Å–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-total-managers">0</div>
                <div class="stat-label">–ù–∞–Ω—è—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-play-time">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –∏–≥—Ä—ã (—á–∞—Å)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-achievements">0/0</div>
                <div class="stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
            </div>
        </div>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
        const businessesConfig = [
            { name: "–õ–∏–º–æ–Ω–Ω—ã–π –∫–∏–æ—Å–∫", baseCost: 15, baseIncome: 0.1, icon: "üçã" },
            { name: "–ì–∞—Ä–∞–∂–Ω—ã–π —Å—Ç–∞—Ä—Ç–∞–ø", baseCost: 100, baseIncome: 1, icon: "üíª" },
            { name: "–ù–µ–±–æ–ª—å—à–æ–π –±–∞–Ω–∫", baseCost: 500, baseIncome: 5, icon: "üè¶" },
            { name: "–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞", baseCost: 1200, baseIncome: 15, icon: "üõ¢Ô∏è" },
            { name: "Tech Giant", baseCost: 5000, baseIncome: 50, icon: "üì±" },
        ];

        const managersConfig = [
            { name: "–°—Ç—É–¥–µ–Ω—Ç-—Å—Ç–∞–∂–µ—Ä", businessIndex: 0, cost: 1000, description: "–ê–≤—Ç–æ—Å–±–æ—Ä –¥–ª—è –õ–∏–º–æ–Ω–Ω–æ–≥–æ –∫–∏–æ—Å–∫–∞" },
            { name: "Junior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", businessIndex: 1, cost: 5000, description: "–ê–≤—Ç–æ—Å–±–æ—Ä –¥–ª—è –ì–∞—Ä–∞–∂–∞" },
            { name: "–ë–∞–Ω–∫–∏—Ä", businessIndex: 2, cost: 15000, description: "–ê–≤—Ç–æ—Å–±–æ—Ä –¥–ª—è –ë–∞–Ω–∫–∞" },
            { name: "–ù–µ—Ñ—Ç—è–Ω–æ–π –º–∞–≥–Ω–∞—Ç", businessIndex: 3, cost: 50000, description: "–ê–≤—Ç–æ—Å–±–æ—Ä –¥–ª—è –í—ã—à–∫–∏" },
            { name: "CEO", businessIndex: 4, cost: 200000, description: "–ê–≤—Ç–æ—Å–±–æ—Ä –¥–ª—è Tech Giant" },
        ];

        const boostsConfig = [
            { name: "–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞", cost: 500, duration: 30, description: "2x –¥–æ—Ö–æ–¥ –æ—Ç –±–∏–∑–Ω–µ—Å–∞", effect: (game) => { game.boostMultiplier = 2; } },
            { name: "–°—É–ø–µ—Ä–∫–ª–∏–∫", cost: 300, duration: 15, description: "10x –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫", effect: (game) => { game.clickBoostMultiplier = 10; } },
            { name: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç", cost: 1000, duration: 20, description: "+5% –¥–æ—Ö–æ–¥–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É", effect: (game) => { game.growthBoost = true; } }
        ];

        const achievementsConfig = [
            { id: "first_million", name: "–ü–µ—Ä–≤—ã–π –º–∏–ª–ª–∏–æ–Ω", description: "–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 1,000,000$", goal: 1000000, reward: 50000 },
            { id: "click_master", name: "–ú–∞—Å—Ç–µ—Ä –∫–ª–∏–∫–∞", description: "–°–¥–µ–ª–∞—Ç—å 1000 –∫–ª–∏–∫–æ–≤", goal: 1000, reward: 1000 },
            { id: "business_tycoon", name: "–ë–∏–∑–Ω–µ—Å-–º–∞–≥–Ω–∞—Ç", description: "–ö—É–ø–∏—Ç—å 50 –±–∏–∑–Ω–µ—Å–æ–≤", goal: 50, reward: 5000 },
            { id: "manager_pro", name: "–ü—Ä–æ—Ñ–∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", description: "–ù–∞–Ω—è—Ç—å –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤", goal: managersConfig.length, reward: 25000 }
        ];

        // –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´
        let gameState = {
            money: 100,
            coinsPerClick: 1,
            totalEarned: 0,
            totalClicks: 0,
            totalBusinesses: 0,
            playTime: 0,
            lastSaveTime: Date.now(),
            lastUpdateTime: Date.now(),
            businesses: businessesConfig.map(biz => ({
                ...biz,
                level: 0,
                income: 0,
                cost: biz.baseCost,
                accumulatedIncome: 0
            })),
            managers: managersConfig.map(manager => ({
                ...manager,
                owned: false
            })),
            boosts: boostsConfig.map(boost => ({
                ...boost,
                active: false,
                timeLeft: 0
            })),
            achievements: achievementsConfig.map(ach => ({
                ...ach,
                progress: 0,
                completed: false,
                claimed: false
            })),
            boostMultiplier: 1,
            clickBoostMultiplier: 1,
            growthBoost: false,
            growthBoostProgress: 0,
            channelBonusClaimed: false
        };

        // –¢–ï–õ–ï–ì–†–ê–ú
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.BackButton.hide();
        tg.ready();

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        function initGame() {
            loadGame();
            renderAllSections();
            updateUI();
            startGameLoop();
            calculateOfflineEarnings();
            loadGlobalLeaderboard();
        }

        // –ò–ì–†–û–í–û–ô –¶–ò–ö–õ
        function startGameLoop() {
            setInterval(() => {
                updateBusinessIncome();
                updateBoosts();
                updateAchievements();
                updateStats();
                gameState.playTime += 1/3600;
                updateUI();
            }, 1000);

            setInterval(saveGame, 30000);
        }

        function updateBusinessIncome() {
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdateTime) / 1000;
            gameState.lastUpdateTime = now;

            gameState.businesses.forEach(business => {
                if (business.level > 0) {
                    let income = business.income * gameState.boostMultiplier;
                    
                    if (gameState.growthBoost) {
                        income *= (1 + gameState.growthBoostProgress * 0.05);
                    }

                    const incomeThisFrame = income * deltaTime;
                    business.accumulatedIncome += incomeThisFrame;
                }
            });

            if (gameState.growthBoost) {
                gameState.growthBoostProgress += deltaTime;
            }
        }

        function updateBoosts() {
            gameState.boosts.forEach(boost => {
                if (boost.active) {
                    boost.timeLeft -= 1;
                    if (boost.timeLeft <= 0) {
                        boost.active = false;
                        if (boost.name === "–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞") gameState.boostMultiplier = 1;
                        if (boost.name === "–°—É–ø–µ—Ä–∫–ª–∏–∫") gameState.clickBoostMultiplier = 1;
                        if (boost.name === "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç") {
                            gameState.growthBoost = false;
                            gameState.growthBoostProgress = 0;
                        }
                    }
                }
            });
        }

        function updateAchievements() {
            gameState.achievements.forEach((achievement, index) => {
                if (!achievement.completed) {
                    let progress = 0;
                    switch(achievement.id) {
                        case "first_million":
                            progress = gameState.totalEarned;
                            break;
                        case "click_master":
                            progress = gameState.totalClicks;
                            break;
                        case "business_tycoon":
                            progress = gameState.totalBusinesses;
                            break;
                        case "manager_pro":
                            progress = gameState.managers.filter(m => m.owned).length;
                            break;
                    }
                    
                    achievement.progress = Math.min(progress, achievement.goal);
                    if (achievement.progress >= achievement.goal) {
                        achievement.completed = true;
                        showNotification(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.name}!`);
                    }
                }
            });
        }

        function updateStats() {
            document.getElementById('stat-total-earned').textContent = Math.floor(gameState.totalEarned).toLocaleString();
            document.getElementById('stat-total-clicks').textContent = gameState.totalClicks.toLocaleString();
            document.getElementById('stat-total-businesses').textContent = gameState.totalBusinesses;
            document.getElementById('stat-total-managers').textContent = gameState.managers.filter(m => m.owned).length;
            document.getElementById('stat-play-time').textContent = gameState.playTime.toFixed(1);
            document.getElementById('stat-achievements').textContent = 
                `${gameState.achievements.filter(a => a.completed).length}/${gameState.achievements.length}`;
        }

        // –û–°–ù–û–í–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø
        function clickCoin() {
            const clickValue = gameState.coinsPerClick * gameState.clickBoostMultiplier;
            gameState.money += clickValue;
            gameState.totalEarned += clickValue;
            gameState.totalClicks++;
            updateUI();
        }

        function collectAllIncome() {
            let totalCollected = 0;
            gameState.businesses.forEach(business => {
                if (business.accumulatedIncome > 0) {
                    totalCollected += business.accumulatedIncome;
                    business.accumulatedIncome = 0;
                }
            });
            
            if (totalCollected > 0) {
                gameState.money += totalCollected;
                gameState.totalEarned += totalCollected;
                showNotification(`+$${totalCollected.toFixed(2)}`);
                updateUI();
            }
        }

        function buyBusiness(index) {
            const business = gameState.businesses[index];
            if (gameState.money >= business.cost) {
                gameState.money -= business.cost;
                business.level += 1;
                business.income = business.baseIncome * business.level;
                business.cost = Math.ceil(business.baseCost * Math.pow(1.5, business.level));
                
                gameState.totalBusinesses++;
                updateUI();
                renderBusiness(index);
            }
        }

        function buyUpgrade() {
            const nextCost = Math.floor(10 * Math.pow(gameState.coinsPerClick, 1.5));
            if (gameState.money >= nextCost) {
                gameState.money -= nextCost;
                gameState.coinsPerClick += 1;
                updateUI();
                renderUpgrades();
            }
        }

        function hireManager(index) {
            const manager = gameState.managers[index];
            if (!manager.owned && gameState.money >= manager.cost) {
                gameState.money -= manager.cost;
                manager.owned = true;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¥–ª—è —ç—Ç–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞
                const business = gameState.businesses[manager.businessIndex];
                setInterval(() => {
                    if (business.accumulatedIncome > 0) {
                        gameState.money += business.accumulatedIncome;
                        gameState.totalEarned += business.accumulatedIncome;
                        business.accumulatedIncome = 0;
                        updateUI();
                    }
                }, 1000);
                
                updateUI();
                renderManager(index);
            }
        }

        function activateBoost(index) {
            const boost = gameState.boosts[index];
            if (!boost.active && gameState.money >= boost.cost) {
                gameState.money -= boost.cost;
                boost.active = true;
                boost.timeLeft = boost.duration;
                boost.effect(gameState);
                updateUI();
                renderBoost(index);
            }
        }

        function claimAchievement(index) {
            const achievement = gameState.achievements[index];
            if (achievement.completed && !achievement.claimed) {
                achievement.claimed = true;
                gameState.money += achievement.reward;
                showNotification(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: +$${achievement.reward}`);
                updateUI();
                renderAchievement(index);
            }
        }

        function claimChannelBonus() {
            if (!gameState.channelBonusClaimed) {
                // –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô –†–ï–ê–õ–¨–ù–´–ô –ö–ê–ù–ê–õ!
                tg.openTelegramLink('https://t.me/hammer_head_channel');
                gameState.money += 100;
                gameState.channelBonusClaimed = true;
                showNotification('+100$ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É!');
                updateUI();
            }
        }

        // –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í
        async function updateGlobalLeaderboard() {
            try {
                const leaderboardKey = 'dollar_empire_leaderboard';
                let leaderboard = JSON.parse(tg.CloudStorage.getItem(leaderboardKey) || '[]');
                
                const user = tg.initDataUnsafe.user;
                const userId = user?.id || 'anonymous';
                const username = user?.username || 'Player';
                
                const existingIndex = leaderboard.findIndex(entry => entry.userId === userId);
                
                if (existingIndex !== -1) {
                    if (gameState.totalEarned > leaderboard[existingIndex].score) {
                        leaderboard[existingIndex].score = gameState.totalEarned;
                    }
                } else {
                    leaderboard.push({
                        userId,
                        username,
                        score: gameState.totalEarned
                    });
                }
                
                leaderboard.sort((a, b) => b.score - a.score);
                leaderboard = leaderboard.slice(0, 100);
                
                tg.CloudStorage.setItem(leaderboardKey, JSON.stringify(leaderboard));
                loadGlobalLeaderboard();
                showNotification('–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
            }
        }

        function loadGlobalLeaderboard() {
            try {
                const leaderboardKey = 'dollar_empire_leaderboard';
                const leaderboard = JSON.parse(tg.CloudStorage.getItem(leaderboardKey) || '[]');
                const list = document.getElementById('leaderboard-list');
                
                list.innerHTML = '';
                leaderboard.slice(0, 10).forEach((entry, index) => {
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item';
                    item.innerHTML = `
                        <span class="leaderboard-rank">#${index + 1}</span>
                        <span class="leaderboard-name">${entry.username}</span>
                        <span class="leaderboard-score">$${entry.score.toLocaleString()}</span>
                    `;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
            }
        }

        // –†–ï–ù–î–ï–† –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.querySelector(`button[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        function renderAllSections() {
            renderBusinesses();
            renderUpgrades();
            renderManagers();
            renderBoosts();
            renderAchievements();
        }

        function renderBusinesses() {
            const container = document.getElementById('business-list');
            container.innerHTML = '';
            
            gameState.businesses.forEach((business, index) => {
                const bizElement = document.createElement('button');
                bizElement.className = 'business-item';
                bizElement.onclick = () => buyBusiness(index);
                bizElement.innerHTML = `
                    <div class="business-header">
                        <span class="business-name">${business.icon} ${business.name}</span>
                        <span class="business-income">+$${business.income.toFixed(1)}/—Å–µ–∫</span>
                    </div>
                    <div class="business-header">
                        <span class="business-level">–£—Ä–æ–≤–µ–Ω—å: ${business.level}</span>
                        <span class="business-cost">$${business.cost}</span>
                    </div>
                    ${business.accumulatedIncome > 0 ? 
                        `<div class="business-accumulated">–ù–∞–∫–æ–ø–ª–µ–Ω–æ: $${business.accumulatedIncome.toFixed(1)}</div>` : ''
                    }
                `;
                bizElement.disabled = gameState.money < business.cost;
                container.appendChild(bizElement);
            });
        }

        function renderBusiness(index) {
            const business = gameState.businesses[index];
            const buttons = document.querySelectorAll('.business-item');
            if (buttons[index]) {
                buttons[index].innerHTML = `
                    <div class="business-header">
                        <span class="business-name">${business.icon} ${business.name}</span>
                        <span class="business-income">+$${business.income.toFixed(1)}/—Å–µ–∫</span>
                    </div>
                    <div class="business-header">
                        <span class="business-level">–£—Ä–æ–≤–µ–Ω—å: ${business.level}</span>
                        <span class="business-cost">$${business.cost}</span>
                    </div>
                    ${business.accumulatedIncome > 0 ? 
                        `<div class="business-accumulated">–ù–∞–∫–æ–ø–ª–µ–Ω–æ: $${business.accumulatedIncome.toFixed(1)}</div>` : ''
                    }
                `;
                buttons[index].disabled = gameState.money < business.cost;
            }
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades-list');
            const nextCost = Math.floor(10 * Math.pow(gameState.coinsPerClick, 1.5));
            
            container.innerHTML = `
                <button class="upgrade-item" onclick="buyUpgrade()">
                    <div class="upgrade-header">
                        <span class="upgrade-name">üíé –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã</span>
                        <span class="upgrade-cost">$${nextCost}</span>
                    </div>
                    <div>+1$ –∑–∞ –∫–ª–∏–∫ (–£—Ä–æ–≤–µ–Ω—å ${gameState.coinsPerClick})</div>
                </button>
            `;
        }

        function renderManagers() {
            const container = document.getElementById('managers-list');
            container.innerHTML = '';
            
            gameState.managers.forEach((manager, index) => {
                const business = gameState.businesses[manager.businessIndex];
                const managerElement = document.createElement('button');
                managerElement.className = 'manager-item';
                managerElement.onclick = () => hireManager(index);
                managerElement.innerHTML = `
                    <div class="manager-header">
                        <span class="manager-name">üëî ${manager.name}</span>
                        <span class="manager-cost">$${manager.cost}</span>
                    </div>
                    <div>${manager.description}</div>
                    ${manager.owned ? '<div class="manager-owned">‚úî –ù–∞–Ω—è—Ç</div>' : ''}
                `;
                managerElement.disabled = manager.owned || gameState.money < manager.cost;
                container.appendChild(managerElement);
            });
        }

        function renderManager(index) {
            const manager = gameState.managers[index];
            const buttons = document.querySelectorAll('.manager-item');
            if (buttons[index]) {
                buttons[index].innerHTML = `
                    <div class="manager-header">
                        <span class="manager-name">üëî ${manager.name}</span>
                        <span class="manager-cost">$${manager.cost}</span>
                    </div>
                    <div>${manager.description}</div>
                    ${manager.owned ? '<div class="manager-owned">‚úî –ù–∞–Ω—è—Ç</div>' : ''}
                `;
                buttons[index].disabled = manager.owned || gameState.money < manager.cost;
            }
        }

        function renderBoosts() {
            const container = document.getElementById('boosts-list');
            container.innerHTML = '';
            
            gameState.boosts.forEach((boost, index) => {
                const boostElement = document.createElement('button');
                boostElement.className = 'boost-item';
                boostElement.onclick = () => activateBoost(index);
                boostElement.innerHTML = `
                    <div class="boost-header">
                        <span class="boost-name">‚ö° ${boost.name}</span>
                        <span class="boost-cost">$${boost.cost}</span>
                    </div>
                    <div>${boost.description}</div>
                    ${boost.active ? `<div class="boost-timer">‚è∞ ${boost.timeLeft}—Å–µ–∫</div>` : ''}
                `;
                boostElement.disabled = boost.active || gameState.money < boost.cost;
                container.appendChild(boostElement);
            });
        }

        function renderBoost(index) {
            const boost = gameState.boosts[index];
            const buttons = document.querySelectorAll('.boost-item');
            if (buttons[index]) {
                buttons[index].innerHTML = `
                    <div class="boost-header">
                        <span class="boost-name">‚ö° ${boost.name}</span>
                        <span class="boost-cost">$${boost.cost}</span>
                    </div>
                    <div>${boost.description}</div>
                    ${boost.active ? `<div class="boost-timer">‚è∞ ${boost.timeLeft}—Å–µ–∫</div>` : ''}
                `;
                buttons[index].disabled = boost.active || gameState.money < boost.cost;
            }
        }

        function renderAchievements() {
            const container = document.getElementById('achievements-list');
            container.innerHTML = '';
            
            gameState.achievements.forEach((achievement, index) => {
                const progressPercent = (achievement.progress / achievement.goal) * 100;
                const achievementElement = document.createElement('button');
                achievementElement.className = 'achievement-item';
                achievementElement.onclick = () => claimAchievement(index);
                achievementElement.innerHTML = `
                    <div class="achievement-header">
                        <span class="achievement-name">üèÜ ${achievement.name}</span>
                        ${achievement.claimed ? '<span style="color:#4caf50">‚úî</span>' : 
                          achievement.completed ? '<span style="color:#ff9800">üéÅ</span>' : ''}
                    </div>
                    <div class="achievement-description">${achievement.description}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: ${progressPercent}%"></div>
                    </div>
                    <div>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${achievement.progress}/${achievement.goal}</div>
                    ${achievement.completed && !achievement.claimed ? 
                        '<div style="color: #ff9800; margin-top: 5px;">–ù–∞–≥—Ä–∞–¥–∞: $' + achievement.reward + '</div>' : ''}
                    ${achievement.claimed ? '<div style="color: #4caf50; margin-top: 5px;">‚úî –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞</div>' : ''}
                `;
                achievementElement.disabled = !achievement.completed || achievement.claimed;
                container.appendChild(achievementElement);
            });
        }

        function renderAchievement(index) {
            const achievement = gameState.achievements[index];
            const buttons = document.querySelectorAll('.achievement-item');
            if (buttons[index]) {
                const progressPercent = (achievement.progress / achievement.goal) * 100;
                buttons[index].innerHTML = `
                    <div class="achievement-header">
                        <span class="achievement-name">üèÜ ${achievement.name}</span>
                        ${achievement.claimed ? '<span style="color:#4caf50">‚úî</span>' : 
                          achievement.completed ? '<span style="color:#ff9800">üéÅ</span>' : ''}
                    </div>
                    <div class="achievement-description">${achievement.description}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: ${progressPercent}%"></div>
                    </div>
                    <div>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${achievement.progress}/${achievement.goal}</div>
                    ${achievement.completed && !achievement.claimed ? 
                        '<div style="color: #ff9800; margin-top: 5px;">–ù–∞–≥—Ä–∞–¥–∞: $' + achievement.reward + '</div>' : ''}
                    ${achievement.claimed ? '<div style="color: #4caf50; margin-top: 5px;">‚úî –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞</div>' : ''}
                `;
                buttons[index].disabled = !achievement.completed || achievement.claimed;
            }
        }

        function updateUI() {
            const totalIncome = gameState.businesses.reduce((total, biz) => total + biz.income, 0) * gameState.boostMultiplier;
            document.getElementById('balance').textContent = `$${gameState.money.toFixed(2)}`;
            document.getElementById('income-per-sec').textContent = `+$${totalIncome.toFixed(1)}/—Å–µ–∫`;
            document.getElementById('coins-per-click').textContent = gameState.coinsPerClick;

            renderAllSections();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        // –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –ó–ê–ì–†–£–ó–ö–ê
        function saveGame() {
            gameState.lastSaveTime = Date.now();
            gameState.lastUpdateTime = Date.now();
            localStorage.setItem('dollarEmpireSave', JSON.stringify(gameState));
        }

        function loadGame() {
            try {
                const save = JSON.parse(localStorage.getItem('dollarEmpireSave'));
                if (save) {
                    Object.assign(gameState, save);
                    gameState.lastUpdateTime = Date.now();
                }
            } catch (error) {
                console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã, –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é');
            }
        }

        function calculateOfflineEarnings() {
            const save = JSON.parse(localStorage.getItem('dollarEmpireSave'));
            if (save && save.lastUpdateTime) {
                const offlineTime = (Date.now() - save.lastUpdateTime) / 1000;
                
                if (offlineTime > 10) {
                    let totalOfflineIncome = 0;
                    save.businesses.forEach(business => {
                        if (business.level > 0) {
                            totalOfflineIncome += business.income * offlineTime;
                        }
                    });

                    if (totalOfflineIncome > 0) {
                        gameState.money += totalOfflineIncome;
                        gameState.totalEarned += totalOfflineIncome;
                        showNotification(`–ó–∞ –≤—Ä–µ–º—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è: +$${totalOfflineIncome.toFixed(2)}!`);
                    }
                }
            }
        }

        // –ó–ê–ü–£–°–ö
        window.onload = initGame;
    </script>
</body>
</html>
