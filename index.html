<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dollar Empire Alpha 0.2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        :root {
            --bg-color: #1a1a1a;
            --text-color: gold;
            --panel-color: #252525;
            --button-color: #333;
            --button-hover: #444;
        }
        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            user-select: none;
        }
        #app {
            padding: 10px;
        }
        /* –®–ê–ü–ö–ê –° –ë–ê–õ–ê–ù–°–û–ú */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: var(--panel-color);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        #balance {
            font-size: 1.5em;
            font-weight: bold;
        }
        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø (–¢–ê–ë–´) */
        #tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        .tab-button {
            padding: 10px 15px;
            background-color: var(--button-color);
            border: none;
            border-radius: 5px;
            color: var(--text-color);
            cursor: pointer;
            flex-grow: 1;
            margin: 0 2px;
        }
        .tab-button.active {
            background-color: #555;
            font-weight: bold;
        }
        /* –°–û–î–ï–†–ñ–ò–ú–û–ï –¢–ê–ë–û–í */
        .tab-content {
            display: none;
            background-color: var(--panel-color);
            padding: 15px;
            border-radius: 10px;
            min-height: 50vh;
        }
        .tab-content.active {
            display: block;
        }
        /* –ú–û–ù–ï–¢–ê */
        #coin-container {
            text-align: center;
            margin: 20px 0;
        }
        #coin {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #daa520);
            border-radius: 50%;
            margin: 0 auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
            transition: transform 0.1s;
        }
        #coin:active {
            transform: scale(0.95);
        }
        /* –ö–ù–û–ü–ö–ò */
        button {
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            text-align: left;
        }
        button:disabled {
            background-color: #222;
            color: #666;
            cursor: not-allowed;
        }
        button:enabled:hover {
            background-color: var(--button-hover);
        }
        .business-info, .upgrade-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        .business-name {
            font-weight: bold;
        }
        .business-income {
            color: #4caf50; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –¥–æ—Ö–æ–¥–∞ */
        }
        .cost {
            color: #f44336; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ */
        }
        /* –°–ü–ò–°–ö–ò */
        #business-list, #upgrades-list {
            max-height: 50vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –®–ê–ü–ö–ê –° –î–ï–ù–¨–ì–ê–ú–ò -->
        <div id="header">
            <div>$</div>
            <div id="balance">0</div>
            <button onclick="collectAllIncome()">–°–û–ë–†–ê–¢–¨ –í–°–Å</button>
        </div>

        <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <div id="tabs">
            <button class="tab-button active" onclick="switchTab('main')">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab-button" onclick="switchTab('business')">–ë–∏–∑–Ω–µ—Å</button>
            <button class="tab-button" onclick="switchTab('upgrades')">–£–ª—É—á—à–µ–Ω–∏—è</button>
        </div>

        <!-- –¢–ê–ë –ì–õ–ê–í–ù–û–ô -->
        <div id="main-tab" class="tab-content active">
            <div id="coin-container">
                <div id="coin" onclick="clickCoin()">–ö–õ–ò–ö–ê–ô!</div>
                <p>–ó–∞ –∫–ª–∏–∫: <span id="coins-per-click">1</span>$</p>
            </div>
        </div>

        <!-- –¢–ê–ë –ë–ò–ó–ù–ï–°–ê -->
        <div id="business-tab" class="tab-content">
            <div id="business-list">
                <!-- –°–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å–æ–≤ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –¢–ê–ë –£–õ–£–ß–®–ï–ù–ò–ô -->
        <div id="upgrades-tab" class="tab-content">
            <div id="upgrades-list">
                <!-- –°–ø–∏—Å–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ==========
        const businessesConfig = [
            { name: "–õ–∏–º–æ–Ω–Ω—ã–π –∫–∏–æ—Å–∫", baseCost: 15, baseIncome: 0.1, icon: "üçã" },
            { name: "–ì–∞—Ä–∞–∂–Ω—ã–π —Å—Ç–∞—Ä—Ç–∞–ø", baseCost: 100, baseIncome: 0.5, icon: "üíª" },
            { name: "–ù–µ–±–æ–ª—å—à–æ–π –±–∞–Ω–∫", baseCost: 500, baseIncome: 4, icon: "üè¶" },
            { name: "–ù–µ—Ñ—Ç—è–Ω–∞—è –≤—ã—à–∫–∞", baseCost: 3000, baseIncome: 25, icon: "üõ¢Ô∏è" },
            { name: "Tech Giant", baseCost: 20000, baseIncome: 150, icon: "üì±" },
        ];

        const upgradesConfig = [
            { 
                name: "–£–ª—É—á—à–µ–Ω–∏–µ –º–æ–Ω–µ—Ç—ã", 
                description: "+1$ –∑–∞ –∫–ª–∏–∫", 
                baseCost: 10, 
                effect: (game) => { game.coinsPerClick += 1; }, 
                type: "click" 
            },
            { 
                name: "–ó–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞", 
                description: "x2 –∑–∞ –∫–ª–∏–∫", 
                baseCost: 500, 
                effect: (game) => { game.coinsPerClick *= 2; }, 
                type: "click" 
            },
        ];

        // ========== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ==========
        let gameState = {
            money: 0,
            coinsPerClick: 1,
            lastSaveTime: Date.now(),
            businesses: businessesConfig.map(biz => ({
                ...biz,
                level: 0,
                income: 0,
                cost: biz.baseCost,
                accumulatedIncome: 0
            })),
            upgrades: upgradesConfig.map(up => ({
                ...up,
                level: 0,
                cost: up.baseCost,
                bought: false
            })),
            lastUpdateTime: Date.now() // –î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Ö–æ–¥–∞
        };

        // ========== T–ï–õ–ï–ì–†–ê–ú –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.BackButton.hide();

        function initGame() {
            loadGame();
            renderAllBusinesses();
            renderAllUpgrades();
            updateUI();
            startGameLoop();

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å—á–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Ö–æ–¥–∞
            calculateOfflineEarnings();
        }

        // ========== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ==========
        function startGameLoop() {
            setInterval(() => {
                updateBusinessIncome();
                updateUI();
            }, 1000); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Ö–æ–¥ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

            setInterval(saveGame, 30000); // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
        }

        function updateBusinessIncome() {
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdateTime) / 1000; // –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdateTime = now;

            let totalIncomePerSecond = 0;

            gameState.businesses.forEach(business => {
                if (business.level > 0) {
                    const incomeThisFrame = business.income * deltaTime;
                    business.accumulatedIncome += incomeThisFrame;
                    totalIncomePerSecond += business.income;
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ–±—â–µ–≥–æ –¥–æ—Ö–æ–¥–∞ –≤ —Å–µ–∫—É–Ω–¥—É
            document.getElementById('header').dataset.incomePerSecond = totalIncomePerSecond.toFixed(1);
        }

        function calculateOfflineEarnings() {
            const lastSave = localStorage.getItem('dollarEmpireSave');
            if (lastSave) {
                const save = JSON.parse(lastSave);
                const offlineTime = (Date.now() - save.lastUpdateTime) / 1000; // –°–µ–∫—É–Ω–¥—ã

                if (offlineTime > 10) { // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 10 —Å–µ–∫—É–Ω–¥
                    let offlineEarnings = 0;
                    save.businesses.forEach(business => {
                        if (business.level > 0) {
                            offlineEarnings += business.income * offlineTime;
                        }
                    });

                    if (offlineEarnings > 0) {
                        gameState.money += offlineEarnings;
                        alert(`–ó–∞ –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏: $${offlineEarnings.toFixed(2)}!`);
                        updateUI();
                    }
                }
            }
            gameState.lastUpdateTime = Date.now();
        }

        // ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ==========
        function clickCoin() {
            gameState.money += gameState.coinsPerClick;
            updateUI();
        }

        function collectAllIncome() {
            gameState.businesses.forEach(business => {
                if (business.accumulatedIncome > 0) {
                    gameState.money += business.accumulatedIncome;
                    business.accumulatedIncome = 0;
                }
            });
            updateUI();
        }

        function buyBusiness(index) {
            const business = gameState.businesses[index];
            if (gameState.money >= business.cost) {
                gameState.money -= business.cost;
                business.level += 1;
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ—Ö–æ–¥ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å
                business.income = business.baseIncome * business.level;
                business.cost = Math.ceil(business.baseCost * Math.pow(1.8, business.level));
                renderBusiness(index);
                updateUI();
            }
        }

        function buyUpgrade(index) {
            const upgrade = gameState.upgrades[index];
            if (!upgrade.bought && gameState.money >= upgrade.cost) {
                gameState.money -= upgrade.cost;
                upgrade.bought = true;
                upgrade.effect(gameState); // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —É–ª—É—á—à–µ–Ω–∏—è
                renderUpgrade(index);
                updateUI();
            }
        }

        // ========== –†–ï–ù–î–ï–† –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.querySelector(`button[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        function renderAllBusinesses() {
            const container = document.getElementById('business-list');
            container.innerHTML = '';
            gameState.businesses.forEach((business, index) => {
                const bizElement = document.createElement('button');
                bizElement.onclick = () => buyBusiness(index);
                bizElement.innerHTML = `
                    <div class="business-info">
                        <span>${business.icon} <span class="business-name">${business.name}</span> (–£—Ä. ${business.level})</span>
                        <span class="business-income">+$${business.income.toFixed(1)}/—Å–µ–∫</span>
                    </div>
                    <div>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: $${business.accumulatedIncome.toFixed(1)}</div>
                    <div class="cost">–ö—É–ø–∏—Ç—å: $${business.cost}</div>
                `;
                bizElement.disabled = gameState.money < business.cost;
                container.appendChild(bizElement);
            });
        }

        function renderBusiness(index) {
            const business = gameState.businesses[index];
            const buttons = document.querySelectorAll('#business-list button');
            if (buttons[index]) {
                buttons[index].innerHTML = `
                    <div class="business-info">
                        <span>${business.icon} <span class="business-name">${business.name}</span> (–£—Ä. ${business.level})</span>
                        <span class="business-income">+$${business.income.toFixed(1)}/—Å–µ–∫</span>
                    </div>
                    <div>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: $${business.accumulatedIncome.toFixed(1)}</div>
                    <div class="cost">–ö—É–ø–∏—Ç—å: $${business.cost}</div>
                `;
                buttons[index].disabled = gameState.money < business.cost;
            }
        }

        function renderAllUpgrades() {
            const container = document.getElementById('upgrades-list');
            container.innerHTML = '';
            gameState.upgrades.forEach((upgrade, index) => {
                const upElement = document.createElement('button');
                upElement.onclick = () => buyUpgrade(index);
                upElement.innerHTML = `
                    <div class="upgrade-info">
                        <span class="business-name">${upgrade.name}</span>
                        <span class="cost">$${upgrade.cost}</span>
                    </div>
                    <div>${upgrade.description}</div>
                `;
                upElement.disabled = upgrade.bought || gameState.money < upgrade.cost;
                container.appendChild(upElement);
            });
        }

        function renderUpgrade(index) {
            const upgrade = gameState.upgrades[index];
            const buttons = document.querySelectorAll('#upgrades-list button');
            if (buttons[index]) {
                buttons[index].innerHTML = `
                    <div class="upgrade-info">
                        <span class="business-name">${upgrade.name}</span>
                        <span class="cost">$${upgrade.cost}</span>
                    </div>
                    <div>${upgrade.description}</div>
                `;
                buttons[index].disabled = upgrade.bought || gameState.money < upgrade.cost;
            }
        }

        function updateUI() {
            document.getElementById('balance').textContent = gameState.money.toFixed(2);
            document.getElementById('coins-per-click').textContent = gameState.coinsPerClick;

            const incomePerSecond = gameState.businesses.reduce((total, biz) => total + biz.income, 0);
            document.getElementById('header').querySelector('div:nth-child(2)').innerHTML = `
                ${gameState.money.toFixed(2)}<br>
                <small>+${incomePerSecond.toFixed(1)}/—Å–µ–∫</small>
            `;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            renderAllBusinesses();
            renderAllUpgrades();
        }

        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –ó–ê–ì–†–£–ó–ö–ê ==========
        function saveGame() {
            gameState.lastSaveTime = Date.now();
            gameState.lastUpdateTime = Date.now();
            localStorage.setItem('dollarEmpireSave', JSON.stringify(gameState));
        }

        function loadGame() {
            const save = JSON.parse(localStorage.getItem('dollarEmpireSave'));
            if (save) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
                gameState.money = save.money || 0;
                gameState.coinsPerClick = save.coinsPerClick || 1;
                gameState.lastSaveTime = save.lastSaveTime || Date.now();
                gameState.lastUpdateTime = save.lastUpdateTime || Date.now();

                // –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –±–∏–∑–Ω–µ—Å—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–æ –±–µ—Ä–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                if (save.businesses) {
                    gameState.businesses = businessesConfig.map((bizConfig, i) => {
                        const savedBiz = save.businesses[i] || {};
                        return {
                            ...bizConfig,
                            level: savedBiz.level || 0,
                            income: savedBiz.income || 0,
                            cost: savedBiz.cost || bizConfig.baseCost,
                            accumulatedIncome: savedBiz.accumulatedIncome || 0
                        };
                    });
                }

                if (save.upgrades) {
                    gameState.upgrades = upgradesConfig.map((upConfig, i) => {
                        const savedUp = save.upgrades[i] || {};
                        return {
                            ...upConfig,
                            level: savedUp.level || 0,
                            cost: savedUp.cost || upConfig.baseCost,
                            bought: savedUp.bought || false
                        };
                    });
                }
            }
        }

        // ========== –ó–ê–ü–£–°–ö ==========
        window.onload = initGame;
    </script>
</body>
</html>
